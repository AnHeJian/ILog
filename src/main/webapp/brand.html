<!DOCTYPE html>

<!--[if IE 9 ]><html class="ie9"><![endif]-->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <meta charset="UTF-8">

    <meta name="description" content="Violate Responsive Admin Template">
    <meta name="keywords" content="Super Admin, Admin, Template, Bootstrap">

    <title>用户终端品牌</title>
    <script src="js/jquery-3.2.1.min.js"></script>

    <!-- Bootstrap -->
    <script src="js/bootstrap.min.js"></script>
    <!--引入ECharts-->

    <script src="js/echarts/echarts.min.js"></script>
    <script src="js/echarts/china.js"></script>
    <script src="js/echarts/dark-blue.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="js/bootstrap-3.3.4.css">
    <link href="css/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="js/font-awesome.4.6.0.css">
    <link href="css/form.css" rel="stylesheet">
    <link href="css/calendar.css" rel="stylesheet">
    <link href="css/media-player.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/icons.css" rel="stylesheet">
    <link href="css/generics.css" rel="stylesheet">
    <link href="css/mstp_map.css" rel="stylesheet">
    <link href="css/menu.css" rel="stylesheet">
    <style type="text/css">
        select
        {
            width: 135px;
        }
        fieldset dl dd
        {
            float: left;
            margin-left: 20px;

        }
        fieldset pre
        {
            width: 100%;
            height: 400px;
            overflow-y: scroll;
            overflow-x: hidden;
        }
    </style>
    <script>
        $(document).ready(function() {

            $("#selProvince").css("width","100px");

        });
    </script>
    <script type="text/javascript" language="javascript">
        //定义数组，存储省份信息
        var province = ["全国","北京", "上海", "天津", "重庆", "浙江", "江苏", "广东", "福建", "湖南", "湖北", "辽宁",
            "吉林", "黑龙江", "河北", "河南", "山东", "陕西", "甘肃", "新疆", "青海", "山西", "四川",
            "贵州", "安徽", "江西", "云南", "内蒙古", "西藏", "广西", "宁夏", "海南", "香港", "澳门", "台湾"];
        $(function () {
            //设置省份数据
            setProvince();

            //设置背景颜色
            setBgColor();
        });


        //设置省份数据
        function setProvince() {
            //给省份下拉列表赋值
            var option, modelVal;
            var $sel = $("#selProvince");

            //获取对应省份城市
            for (var i = 0, len = province.length; i < len; i++) {
                modelVal = province[i];
                option = "<option value='" + modelVal + "'>" + modelVal + "</option>";

                //添加到 select 元素中
                $sel.append(option);
            }

            //调用change事件，初始城市信息
            provinceChange();
        }
        //   //省份选中事件
        //   function provinceChange() {
        //     var $pro = $("#selProvince");
        //     setCity($pro.val());
        // }


        //设置下拉列表间隔背景样色
        function setBgColor() {
            var $option = $("select option:odd");
            $option.css({ "background-color": "#DEDEDE" });
        }
    </script>
</head>

<body id="skin-blur-blue">
<header id="header" class="media">
    <a href="" id="menu-toggle"></a>
    <a class="logo pull-left" href="index.html">用户终端品牌分析</a>


</header>

<div class="clearfix"></div>

<section id="main" class="p-relative" role="main">

    <!-- Sidebar -->
    <aside id="sidebar">

        <ul class="list-unstyled side-menu" style="width: 100%!important;padding-top: 20px;">

            <li class="active">
                <a href="brand.html" id='menuurl1'>
                    <i class="fa fa-bar-chart-o"></i><span> 用户品牌特征</span>
                </a>
            </li>
            <li>
                <a href="detail_brand.html"  id='menuurl2'>
                    <i class="fa fa-sort-amount-asc"></i><span> 用户品牌特征变化</span>
                </a>
            </li>

        </ul>

    </aside>
    <!-- Content -->
    <section id="content" class="container">



        <!-- Breadcrumb -->
        <ol class="breadcrumb hidden-xs">
            <li><a href="index.html">首页</a></li>
            <li class="active">用户终端品牌图</li>
        </ol>
        <h4 class="page-title">用户终端品牌分布</h4>
        <!--   <form class="form-inline"> -->
        <!-- <div class="form-group"> -->
        <!-- <label for="carcard-color2" class="col-sm-2 control-label"> 时间：</label> -->
        <div class="pull-left">
            <span class="page-title">时间：</span>
            <div class="btn-group">
                <button type="button" class="btn btn-default " data-toggle="modal" id="btn-brand-yesterday">
                    昨天
                </button>
                <button type="button" class="btn btn-default" id="btn-brand-lastSevDay">
                    最近七天
                </button>
                <button type="button" class="btn btn-default " data-toggle="modal" data-target="#changeAllTable" id="btn-brand-lastMonth">
                    最近30天
                </button>
            </div>
        </div>

        <!-- <div class="form-group ">  -->
        <span class="page-title pull-left">起始时间：</span>
        <div class="pull-left" >
            <input type="date" class="form-control " id="sTdate1"
                   required="true" dateISO="true">
        </div>
        <span class="page-title pull-left">终止时间：</span>
        <div class="pull-left" id="DateInput">
            <input type="date" class="form-control " id="fNdate1"
                   required="true" dateISO="true">
        </div>
        <!-- </div> -->
        <!-- </div> -->

        <!-- </form> -->
        <fieldset>
            <form class="form-horizontal">
                <span class="page-title pull-left">地点：</span>
                <dl class=" pull-left"  >
                    <dd id="dd">
                        <select class="form-control" id="selProvince" onchange="provinceChange();"></select>
                    </dd>
                </dl>
                <div class="form-group pull-right" >
                    <button type="button" class="btn  btn-default" id="btn-brand-search" style="position:absolute; margin-left:-200px; margin-top:2px">
                        <span class="glyphicon glyphicon-search" aria-hidden="true"></span> 查询</button>
                </div>
            </form>
        </fieldset>

        <div class="block-area">

            <div class="row">
                <!-- World Map -style="width: 100%;height:600px-->
                <div class="col-md-12">
                    <div id="mainBR" style="position: absolute; top: 0px; left: 11px; height: 500px; width: 1057px; border: 1px solid #transparent; padding: 10px;"></div>
                </div>
            </div>
        </div>



        <hr class="whiter m-t-20 m-b-20" />

        <br/><br/><br/>
    </section>
</section>
<script type="text/javascript">
    var myChart = echarts.init(document.getElementById('mainBR'),'dark-blue');
    global_option = {
        title: {
            text: '品牌统计',
            subtext: '昨天',
            left: 'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: "品牌 : {b} <br/> 总量 : {c} <br/> 占比 : {d}%"
        },
        series: [
            {
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                data: [],
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
        ]
    };

    var global_subtext;
    var global_brandData;
    var noData = false;

    //默认界面，显示昨天的信息
    loadBrandData();
    function loadBrandData(){
        $.ajax({
            type : "get",
            async : false, //同步执行
            url : "brand.do",
            data : {
                "method" : "brandQuery",
                "fixedTime" : "1",
                "location" : "全国"
            },
            dataType : "json", //返回数据形式为json
            success : function(result) {
                if(result){
                    //直接将ajax获取的json(即result)复制给echarts，因为option.series[0].data的格式和result格式完全一致
                    if(result=="")
                        noData = true;
                    else {
                        global_option.series[0].data = result;
                        global_brandData = result;
                        global_subtext = '昨天';
                        noData = false;
                    }
                }
            }
        });
        if(noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(global_option,true);
    }

    //扇型图点击响应函数
    myChart.on('click', function (ec){
        if(myChart.getOption().title[0].text=="品牌统计" && ec.name != "其他")
            drawBar(ec);
    });

    function drawBar(ec) {
        var ydata = [];
        var dataAll = [];
        option = {
            backgroundColor: '#0f375f',
            title: [
                {
                    text: ec.name + '机型top5',
                    x: '40%',
                    y: '1%',
                    textStyle: {color: "#fff", fontSize: "14"}
                },

            ],
            toolbox: {
                show: true,
                feature: {
                    myTool: {
                        show: true,
                        title: '返回',
                        icon: 'path://M432.45,595.444c0,2.177-4.661,6.82-11.305,6.82c-6.475,0-11.306-4.567-11.306-6.82s4.852-6.812,11.306-6.812C427.841,588.632,432.452,593.191,432.45,595.444L432.45,595.444z M421.155,589.876c-3.009,0-5.448,2.495-5.448,5.572s2.439,5.572,5.448,5.572c3.01,0,5.449-2.495,5.449-5.572C426.604,592.371,424.165,589.876,421.155,589.876L421.155,589.876z M421.146,591.891c-1.916,0-3.47,1.589-3.47,3.549c0,1.959,1.554,3.548,3.47,3.548s3.469-1.589,3.469-3.548C424.614,593.479,423.062,591.891,421.146,591.891L421.146,591.891zM421.146,591.891',
                        onclick: function () {
                            returnPie()
                        }
                    },
                    mark: {show: true},
                    dataView: {show: true, readOnly: false},
                    restore: {show: false},
                    saveAsImage: {show: true},
                }
            },
            tooltip: {
                formatter: '{b} : {c}'
            },
            grid: {
                left: '10%',
                right: '10%',
                bottom: '12%',
                top : '15%',
                containLabel: true,
            },
            xAxis: [
                {
                    gridIndex: 0,
                    axisTick: {show: false},
                    axisLabel: {show: false},
                    splitLine: {show: false},
                    axisLine: {show: false}
                },
            ],
            yAxis: [
                {
                    gridIndex: 0, interval: 0, data: ydata.reverse(),
                    axisTick: {show: false}, axisLabel: {show: true}, splitLine: {show: false},
                    axisLine: {show: true, lineStyle: {color: "#6173a3"}},
                }
            ],
            series: [
                {
                    name: '型号排名',
                    center: ['22%', '25%'],
                    type: 'bar', xAxisIndex: 0, yAxisIndex: 0, barWidth: '60%',
                    itemStyle: {normal: {color: '#86c9f4'}},
                    label: {normal: {show: true, position: "right", textStyle: {color: "#9EA7C4"}}},
                    data: dataAll.sort()
                },
            ]
        };

        var startDate = document.getElementById("sTdate1").value;
        var endDate = document.getElementById("fNdate1").value;
        var location = document.getElementById("selProvince").value;
        var fixedTime = "0";

        if (global_subtext == "昨天")
            fixedTime = "1";
        if (global_subtext == "最近7天")
            fixedTime = "7";
        if (global_subtext == "最近30天")
            fixedTime = "30";
        if(fixedTime=="0" && (startDate=="" || endDate=="")) {
            alert("请输入查询日期");
            return false;
        };
        //alert(fixedTime+"|"+startDate+"|"+endDate+"|"+ec.name);

        $.ajax({
            type: "get",
            async: false, //同步执行
            url: "brand.do",
            data: {
                "method": "modelQuery",
                "fixedTime": fixedTime,
                "location": location,
                "startDate": startDate,
                "endDate": endDate,
                "brand": ec.name
            },
            dataType: "json", //返回数据形式为json
            success: function (result) {
                if (result) {
                    //直接将ajax获取的json(即result)复制给echarts，因为option.series[0].data的格式和result格式完全一致
                    if (result == "")
                        noData = true;
                    else {
                        //option.series[0].data = [1,1,1,1,1];
                        //option.yAxis[0].data = ['0','0','0','0','0'];
                        for(var i=0;i<5;i++) {
                            ydata[i] = result[i].name;
                            dataAll[i] = result[i].value;
                        }
                        ydata.reverse();
                        dataAll.sort();
                        noData = false;
                    }
                }
            }
        });


        //alert(dataAll);
        if (noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(option, true); //当setOption第二个参数为true时，会阻止数据合并
    }

    function returnPie(ec) {
        option = {
            title: {
                text: '品牌统计',
                subtext: global_subtext,
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series: [
                {
                    type: 'pie',
                    radius: '65%',
                    center: ['50%', '50%'],
                    selectedMode: 'single',
                    data: global_brandData,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        myChart.setOption(option, true); //当setOption第二个参数为true时，会阻止数据合并
    }


    /*按钮事件响应*/
    document.getElementById("btn-brand-yesterday").onclick = function(){
        var location = document.getElementById("selProvince").value;
        var noData = false;

        $.ajax({
            type : "get",
            async : false, //同步执行
            url : "brand.do",
            data : {
                "method" : "brandQuery",
                "fixedTime" : "1",
                "location" : location
            },
            dataType : "json", //返回数据形式为json
            success : function(result) {
                if(result){
                    //直接将ajax获取的json(即result)复制给echarts,因为option.series[0].data的格式和result格式完全一致
                    if(result=="")
                        noData = true;
                    else {
                        global_option.series[0].data = result;
                        global_option.title.subtext = "昨天";
                        global_brandData = result;
                        global_subtext = "昨天";
                        noData = false;
                    }
                }
            }
        });

        if(noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(global_option,true);
    };

    document.getElementById("btn-brand-lastSevDay").onclick = function(){
        var location = document.getElementById("selProvince").value;
        var noData = false;

        $.ajax({
            type : "get",
            async : false, //同步执行
            url : "brand.do",
            data : {
                "method" : "brandQuery",
                "fixedTime" : "7",
                "location" : location
            },
            dataType : "json", //返回数据形式为json
            success : function(result) {
                if(result){
                    //直接将ajax获取的json(即result)复制给echarts，因为option.series[0].data的格式和result格式完全一致
                    if(result=="")
                        noData = true;
                    else {
                        global_option.series[0].data = result;
                        global_option.title.subtext = "最近7天";
                        global_brandData = result;
                        global_subtext = "最近7天";
                        noData = false;
                    }
                }
            }
        });
        if(noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(global_option,true);
    };

    document.getElementById("btn-brand-lastMonth").onclick = function(){
        var location = document.getElementById("selProvince").value;
        var noData = false;

        $.ajax({
            type : "get",
            async : false, //同步执行
            url : "brand.do",
            data : {
                "method" : "brandQuery",
                "fixedTime" : "30",
                "location" : location
            },
            dataType : "json", //返回数据形式为json
            success : function(result) {
                if(result){
                    //直接将ajax获取的json(即result)复制给echarts，因为option.series[0].data的格式和result格式完全一致
                    if(result=="")
                        noData = true;
                    else {
                        global_option.series[0].data = result;
                        global_option.title.subtext = "最近30天";
                        global_brandData = result;
                        global_subtext = "最近30天";
                        noData = false;
                    }
                }
            }
        });
        if(noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(global_option,true);
    };

    document.getElementById("btn-brand-search").onclick = function(){
        var startDate = document.getElementById("sTdate1").value;
        var endDate = document.getElementById("fNdate1").value;
        var location = document.getElementById("selProvince").value;
        var noData = false;

        if(startDate=="" || endDate=="") {
            alert("请输入查询日期");
            return false;
        };

        $.ajax({
            type : "get",
            async : false, //同步执行
            url : "brand.do",
            data : {
                "method" : "brandQuery",
                "fixedTime" : "0",
                "location" : location,
                "startDate" : startDate,
                "endDate" : endDate,
            },
            dataType : "json", //返回数据形式为json
            success : function(result) {
                if(result){
                    //直接将ajax获取的json(即result)复制给echarts，因为option.series[0].data的格式和result格式完全一致
                    if(result=="")
                        noData = true;
                    else {
                        global_option.series[0].data = result;
                        global_option.title.subtext = startDate + " 至 " + endDate;
                        global_brandData = result;
                        global_subtext = startDate + " 至 " + endDate;
                        noData = false;
                    }
                }
            }
        });
        if(noData)
            alert("没有查询到相关信息");
        else
            myChart.setOption(global_option,true);
    };



</script>

<!-- Javascript Libraries -->

<script src="js/jquery-3.2.1.min.js"></script>

<!-- Bootstrap -->
<script src="js/bootstrap.min.js"></script>

<!--引入ECharts-->
<script src="js/echarts/echarts.min.js"></script>
<script src="js/echarts/china.js"></script>
<!-- Charts -->
<script src="js/charts/jquery.flot.js"></script> <!-- Flot Main -->
<script src="js/charts/jquery.flot.time.js"></script> <!-- Flot sub -->
<script src="js/charts/jquery.flot.animator.min.js"></script> <!-- Flot sub -->
<script src="js/charts/jquery.flot.resize.min.js"></script> <!-- Flot sub - for repaint when resizing the screen -->
<script src="js/charts/jquery.flot.orderBar.js"></script> <!-- Flot Bar chart -->
<script src="js/charts/jquery.flot.pie.min.js"></script> <!-- Flot Pie chart -->

<script src="js/sparkline.min.js"></script> <!-- Sparkline - Tiny charts -->
<script src="js/easypiechart.js"></script> <!-- EasyPieChart - Animated Pie Charts -->
<script src="js/mstp_map.js"></script> <!-- All the above chart related functions -->

<!-- Map -->
<script src="js/maps/jvectormap.min.js"></script> <!-- jVectorMap main library -->
<!--Media Player-->
<script src="js/media-player.min.js"></script> <!-- USA Map for jVectorMap -->

<!-- UX -->
<script src="js/scroll.min.js"></script> <!-- Custom Scrollbar -->

<!-- Other -->
<script src="js/calendar.min.js"></script> <!-- Calendar -->
<script src="js/feeds.min.js"></script> <!-- News Feeds -->


<!-- All JS functions -->
<script src="js/functions.js"></script>

<script>
    $(document).ready(function() {
        $('#selProvince').css("width","100px")

        $('#dd').css("margin-left","0px")
    });

</script>
</body>
</html>
